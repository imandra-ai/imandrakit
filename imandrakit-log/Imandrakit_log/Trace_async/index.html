<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Trace_async (imandrakit-log.Imandrakit_log.Trace_async)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">imandrakit-log</a> &#x00BB; <a href="../index.html">Imandrakit_log</a> &#x00BB; Trace_async</nav><header class="odoc-preamble"><h1>Module <code><span>Imandrakit_log.Trace_async</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Trace"><a href="#module-Trace" class="anchor"></a><code><span><span class="keyword">module</span> Trace</span><span> = <a href="../../../trace/Trace_core/index.html">Trace_core</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-span_kind"><a href="#type-span_kind" class="anchor"></a><code><span><span class="keyword">type</span> span_kind</span><span> = </span></code><ol><li id="type-span_kind.SK_client" class="def variant constructor anchored"><a href="#type-span_kind.SK_client" class="anchor"></a><code><span>| </span><span><span class="constructor">SK_client</span></span></code></li><li id="type-span_kind.SK_server" class="def variant constructor anchored"><a href="#type-span_kind.SK_server" class="anchor"></a><code><span>| </span><span><span class="constructor">SK_server</span></span></code></li><li id="type-span_kind.SK_internal" class="def variant constructor anchored"><a href="#type-span_kind.SK_internal" class="anchor"></a><code><span>| </span><span><span class="constructor">SK_internal</span></span></code></li><li id="type-span_kind.SK_producer" class="def variant constructor anchored"><a href="#type-span_kind.SK_producer" class="anchor"></a><code><span>| </span><span><span class="constructor">SK_producer</span></span></code></li><li id="type-span_kind.SK_consumer" class="def variant constructor anchored"><a href="#type-span_kind.SK_consumer" class="anchor"></a><code><span>| </span><span><span class="constructor">SK_consumer</span></span></code></li></ol></div><div class="spec-doc"><p>Inspired from OTEL</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-equal_span_kind"><a href="#val-equal_span_kind" class="anchor"></a><code><span><span class="keyword">val</span> equal_span_kind : <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../ppx_deriving/Ppx_deriving_runtime/index.html#type-bool">Ppx_deriving_runtime.bool</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_kind_to_twine_ref"><a href="#val-span_kind_to_twine_ref" class="anchor"></a><code><span><span class="keyword">val</span> span_kind_to_twine_ref : 
  <span><span>(<span><a href="../../../imandrakit/Imandrakit_twine/Encode/index.html#type-t">Imandrakit_twine.Encode.t</a> <span class="arrow">&#45;&gt;</span></span>
    <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span>
    <a href="../../../imandrakit/Imandrakit_twine/Encode/index.html#type-immediate">Imandrakit_twine.Encode.immediate</a>)</span>
    <a href="../../../ocaml/Stdlib/index.html#type-ref">ref</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_kind_of_twine_ref"><a href="#val-span_kind_of_twine_ref" class="anchor"></a><code><span><span class="keyword">val</span> span_kind_of_twine_ref : 
  <span><span>(<span><a href="../../../imandrakit/Imandrakit_twine/Decode/index.html#type-t">Imandrakit_twine.Decode.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-span_kind">span_kind</a>)</span> <a href="../../../ocaml/Stdlib/index.html#type-ref">ref</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_kind_to_twine"><a href="#val-span_kind_to_twine" class="anchor"></a><code><span><span class="keyword">val</span> span_kind_to_twine : 
  <span><a href="../../../imandrakit/Imandrakit_twine/Encode/index.html#type-t">Imandrakit_twine.Encode.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../imandrakit/Imandrakit_twine/Encode/index.html#type-immediate">Imandrakit_twine.Encode.immediate</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-span_kind_of_twine"><a href="#val-span_kind_of_twine" class="anchor"></a><code><span><span class="keyword">val</span> span_kind_of_twine : <span><a href="../../../imandrakit/Imandrakit_twine/Decode/index.html#type-t">Imandrakit_twine.Decode.t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="#type-span_kind">span_kind</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_span_kind"><a href="#val-pp_span_kind" class="anchor"></a><code><span><span class="keyword">val</span> pp_span_kind : 
  <span><a href="../../../ocaml/Stdlib/Format/index.html#type-formatter">Ppx_deriving_runtime.Format.formatter</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span>
  <a href="../../../ppx_deriving/Ppx_deriving_runtime/index.html#type-unit">Ppx_deriving_runtime.unit</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-show_span_kind"><a href="#val-show_span_kind" class="anchor"></a><code><span><span class="keyword">val</span> show_span_kind : <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../../ppx_deriving/Ppx_deriving_runtime/index.html#type-string">Ppx_deriving_runtime.string</a></span></code></div></div><div class="odoc-spec"><div class="spec type extension anchored" id="extension-decl-Ev_link_span"><a href="#extension-decl-Ev_link_span" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../trace/Trace_core/index.html#type-extension_event">Trace.extension_event</a> += </span></code><ol><li id="extension-Ev_link_span" class="def variant extension anchored"><a href="#extension-Ev_link_span" class="anchor"></a><code><span>| </span><span><span class="extension">Ev_link_span</span> <span class="keyword">of</span> <a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> * <a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Link the given span to the given context. The context isn't the parent, but the link can be used to correlate both spans.</p><span class="comment-delim">*)</span></div></li><li id="extension-Ev_record_exn" class="def variant extension anchored"><a href="#extension-Ev_record_exn" class="anchor"></a><code><span>| </span><span><span class="extension">Ev_record_exn</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="module-Trace_async.sp" class="def record field anchored"><a href="#module-Trace_async.sp" class="anchor"></a><code><span>sp : <a href="../../../trace/Trace_core/index.html#type-span">Trace.span</a>;</span></code></li><li id="module-Trace_async.exn" class="def record field anchored"><a href="#module-Trace_async.exn" class="anchor"></a><code><span>exn : exn;</span></code></li><li id="module-Trace_async.bt" class="def record field anchored"><a href="#module-Trace_async.bt" class="anchor"></a><code><span>bt : <a href="../../../ocaml/Stdlib/Printexc/index.html#type-raw_backtrace">Stdlib.Printexc.raw_backtrace</a>;</span></code></li><li id="module-Trace_async.error" class="def record field anchored"><a href="#module-Trace_async.error" class="anchor"></a><code><span>error : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Is this an actual internal error?</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Record exception and potentially turn span to an error</p><span class="comment-delim">*)</span></div></li><li id="extension-Ev_push_async_parent" class="def variant extension anchored"><a href="#extension-Ev_push_async_parent" class="anchor"></a><code><span>| </span><span><span class="extension">Ev_push_async_parent</span> <span class="keyword">of</span> <a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Set current async span</p><span class="comment-delim">*)</span></div></li><li id="extension-Ev_pop_async_parent" class="def variant extension anchored"><a href="#extension-Ev_pop_async_parent" class="anchor"></a><code><span>| </span><span><span class="extension">Ev_pop_async_parent</span> <span class="keyword">of</span> <a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Remove current async span</p><span class="comment-delim">*)</span></div></li><li id="extension-Ev_set_span_kind" class="def variant extension anchored"><a href="#extension-Ev_set_span_kind" class="anchor"></a><code><span>| </span><span><span class="extension">Ev_set_span_kind</span> <span class="keyword">of</span> <a href="../../../trace/Trace_core/index.html#type-span">Trace.span</a> * <a href="#type-span_kind">span_kind</a></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-link_spans"><a href="#val-link_spans" class="anchor"></a><code><span><span class="keyword">val</span> link_spans : <span><a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">src</span>:<a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Link the given span to the given context</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_span_kind"><a href="#val-set_span_kind" class="anchor"></a><code><span><span class="keyword">val</span> set_span_kind : <span><a href="../../../trace/Trace_core/index.html#type-span">Trace.span</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-span_kind">span_kind</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-k_span_ctx"><a href="#val-k_span_ctx" class="anchor"></a><code><span><span class="keyword">val</span> k_span_ctx : <span><a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <a href="../../../hmap/Hmap/index.html#type-key">Hmap.key</a></span></span></code></div><div class="spec-doc"><p>Current parent scope for async spans</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_exn_to_span"><a href="#val-add_exn_to_span" class="anchor"></a><code><span><span class="keyword">val</span> add_exn_to_span : 
  <span><span class="label">is_error</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../trace/Trace_core/index.html#type-span">Trace.span</a> <span class="arrow">&#45;&gt;</span></span>
  <span>exn <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../ocaml/Stdlib/Printexc/index.html#type-raw_backtrace">Stdlib.Printexc.raw_backtrace</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Record exception in the span</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_async_parent"><a href="#val-push_async_parent" class="anchor"></a><code><span><span class="keyword">val</span> push_async_parent : <span><a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_async_parent"><a href="#val-pop_async_parent" class="anchor"></a><code><span><span class="keyword">val</span> pop_async_parent : <span><a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_async_parent"><a href="#val-with_async_parent" class="anchor"></a><code><span><span class="keyword">val</span> with_async_parent : <span><a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_span"><a href="#val-with_span" class="anchor"></a><code><span><span class="keyword">val</span> with_span : 
  <span><span class="optlabel">?level</span>:<a href="../../../trace/Trace_core/Level/index.html#type-t">Trace.Level.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?parent</span>:<a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?data</span>:<span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(string * <a href="../../../trace/Trace_core/index.html#type-user_data">Trace.user_data</a>)</span> list</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?__FUNCTION__</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">__FILE__</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">__LINE__</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span>(<a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> * <a href="../../../trace/Trace_core/index.html#type-explicit_span_ctx">Trace.explicit_span_ctx</a>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Wrap <code>f()</code> in a async span.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enrich_span_service"><a href="#val-enrich_span_service" class="anchor"></a><code><span><span class="keyword">val</span> enrich_span_service : <span><span class="optlabel">?version</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enrich_span_deployment"><a href="#val-enrich_span_deployment" class="anchor"></a><code><span><span class="keyword">val</span> enrich_span_deployment : 
  <span><span class="optlabel">?id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">deployment</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_auto_enrich_span"><a href="#val-add_auto_enrich_span" class="anchor"></a><code><span><span class="keyword">val</span> add_auto_enrich_span : <span><span>(<span><a href="../../../trace/Trace_core/index.html#type-explicit_span">Trace.explicit_span</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Add a hook that will be called on every explicit span</p></div></div></div></body></html>
