<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Zip (zip.Zip)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">zip</a> &#x00BB; Zip</nav><header class="odoc-preamble"><h1>Module <code><span>Zip</span></code></h1><p>Reading and writing ZIP archives</p><p>This module provides functions for reading and writing ZIP archive files. ZIP archives package one or more compressed files into a single ``ZIP file'' along with information about the files, including file name, date and time of last modification, user-provided comments, and a checksum to verify the integrity of each entry. The entries of a ZIP file are not necessarily actual files, and can actually consist of arbitrary data.</p><p>The ZIP file format used in this module is identical to that implemented by the popular <code>pkzip</code> archiver under Windows, and by the Info-ZIP <code>zip</code> and <code>unzip</code> commands under Unix and Windows. This format is also identical to the JAR file format used by Java.</p></header><nav class="odoc-toc"><ul><li><a href="#information-on-zip-entries">Information on ZIP entries</a></li><li><a href="#reading-from-zip-files">Reading from ZIP files</a></li><li><a href="#writing-to-zip-files">Writing to ZIP files</a></li><li><a href="#error-reporting">Error reporting</a></li></ul></nav><div class="odoc-content"><h2 id="information-on-zip-entries"><a href="#information-on-zip-entries" class="anchor"></a>Information on ZIP entries</h2><div class="odoc-spec"><div class="spec type anchored" id="type-compression_method"><a href="#type-compression_method" class="anchor"></a><code><span><span class="keyword">type</span> compression_method</span><span> = </span></code><ol><li id="type-compression_method.Stored" class="def variant constructor anchored"><a href="#type-compression_method.Stored" class="anchor"></a><code><span>| </span><span><span class="constructor">Stored</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>data is stored without compression</p><span class="comment-delim">*)</span></div></li><li id="type-compression_method.Deflated" class="def variant constructor anchored"><a href="#type-compression_method.Deflated" class="anchor"></a><code><span>| </span><span><span class="constructor">Deflated</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>data is compressed with the ``deflate'' algorithm</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Indicate whether the data in the entry is compressed or not.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-entry"><a href="#type-entry" class="anchor"></a><code><span><span class="keyword">type</span> entry</span><span> = </span><span>{</span></code><ol><li id="type-entry.filename" class="def record field anchored"><a href="#type-entry.filename" class="anchor"></a><code><span>filename : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>file name for entry</p><span class="comment-delim">*)</span></div></li><li id="type-entry.extra" class="def record field anchored"><a href="#type-entry.extra" class="anchor"></a><code><span>extra : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>extra information attached to entry</p><span class="comment-delim">*)</span></div></li><li id="type-entry.comment" class="def record field anchored"><a href="#type-entry.comment" class="anchor"></a><code><span>comment : string;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>comment attached to entry</p><span class="comment-delim">*)</span></div></li><li id="type-entry.methd" class="def record field anchored"><a href="#type-entry.methd" class="anchor"></a><code><span>methd : <a href="#type-compression_method">compression_method</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>compression method</p><span class="comment-delim">*)</span></div></li><li id="type-entry.mtime" class="def record field anchored"><a href="#type-entry.mtime" class="anchor"></a><code><span>mtime : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>last modification time (seconds since epoch)</p><span class="comment-delim">*)</span></div></li><li id="type-entry.crc" class="def record field anchored"><a href="#type-entry.crc" class="anchor"></a><code><span>crc : int32;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>cyclic redundancy check for data</p><span class="comment-delim">*)</span></div></li><li id="type-entry.uncompressed_size" class="def record field anchored"><a href="#type-entry.uncompressed_size" class="anchor"></a><code><span>uncompressed_size : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>size of original data in bytes</p><span class="comment-delim">*)</span></div></li><li id="type-entry.compressed_size" class="def record field anchored"><a href="#type-entry.compressed_size" class="anchor"></a><code><span>compressed_size : int;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>size of compressed data</p><span class="comment-delim">*)</span></div></li><li id="type-entry.is_directory" class="def record field anchored"><a href="#type-entry.is_directory" class="anchor"></a><code><span>is_directory : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>whether this entry represents a directory</p><span class="comment-delim">*)</span></div></li><li id="type-entry.file_offset" class="def record field anchored"><a href="#type-entry.file_offset" class="anchor"></a><code><span>file_offset : int64;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>for internal use</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Description of an entry in a ZIP file.</p></div></div><h2 id="reading-from-zip-files"><a href="#reading-from-zip-files" class="anchor"></a>Reading from ZIP files</h2><div class="odoc-spec"><div class="spec type anchored" id="type-in_file"><a href="#type-in_file" class="anchor"></a><code><span><span class="keyword">type</span> in_file</span></code></div><div class="spec-doc"><p>Abstract type representing a handle opened for reading from a ZIP file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_in"><a href="#val-open_in" class="anchor"></a><code><span><span class="keyword">val</span> open_in : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-in_file">in_file</a></span></code></div><div class="spec-doc"><p>Abstract type representing a handle opened for reading from a ZIP file.</p><p>Open the ZIP file with the given filename. Return a handle opened for reading from this file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-entries"><a href="#val-entries" class="anchor"></a><code><span><span class="keyword">val</span> entries : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-entry">entry</a> list</span></span></code></div><div class="spec-doc"><p>Open the ZIP file with the given filename. Return a handle opened for reading from this file.</p><p>Return a list of all entries in the given ZIP file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-comment"><a href="#val-comment" class="anchor"></a><code><span><span class="keyword">val</span> comment : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return a list of all entries in the given ZIP file.</p><p>Return the comment attached to the given ZIP file, or the empty string if none.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_entry"><a href="#val-find_entry" class="anchor"></a><code><span><span class="keyword">val</span> find_entry : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-entry">entry</a></span></code></div><div class="spec-doc"><p>Return the comment attached to the given ZIP file, or the empty string if none.</p><p><code>Zip.find_entry zf filename</code> returns the description of the entry having name <code>filename</code> in the ZIP file <code>zf</code>. Raises <code>Not_found</code> if no such entry exists. The file name must match exactly; in particular, case is significant. File names must use <code>/</code> (slash) as the directory separator. The name of a directory must end with a trailing <code>/</code> (slash).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_entry"><a href="#val-read_entry" class="anchor"></a><code><span><span class="keyword">val</span> read_entry : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-entry">entry</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>Zip.find_entry zf filename</code> returns the description of the entry having name <code>filename</code> in the ZIP file <code>zf</code>. Raises <code>Not_found</code> if no such entry exists. The file name must match exactly; in particular, case is significant. File names must use <code>/</code> (slash) as the directory separator. The name of a directory must end with a trailing <code>/</code> (slash).</p><p><code>Zip.read_entry zf e</code> reads and uncompresses the data (file contents) associated with entry <code>e</code> of ZIP file <code>zf</code>. The data is returned as a character string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_entry_to_channel"><a href="#val-copy_entry_to_channel" class="anchor"></a><code><span><span class="keyword">val</span> copy_entry_to_channel : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-entry">entry</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ocaml/Stdlib/index.html#type-out_channel">out_channel</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Zip.read_entry zf e</code> reads and uncompresses the data (file contents) associated with entry <code>e</code> of ZIP file <code>zf</code>. The data is returned as a character string.</p><p><code>Zip.copy_entry_to_channel zf e oc</code> reads and uncompresses the data associated with entry <code>e</code> of ZIP file <code>zf</code>. It then writes this data to the output channel <code>oc</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_entry_to_file"><a href="#val-copy_entry_to_file" class="anchor"></a><code><span><span class="keyword">val</span> copy_entry_to_file : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-entry">entry</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Zip.copy_entry_to_channel zf e oc</code> reads and uncompresses the data associated with entry <code>e</code> of ZIP file <code>zf</code>. It then writes this data to the output channel <code>oc</code>.</p><p><code>Zip.copy_entry_to_file zf e destfile</code> reads and uncompresses the data associated with entry <code>e</code> of ZIP file <code>zf</code>. It then writes this data to the file named <code>destfile</code>. The file <code>destfile</code> is created if it does not exist, and overwritten otherwise. The last modification date of the file is set to that indicated in the ZIP entry <code>e</code>, if possible.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_in"><a href="#val-close_in" class="anchor"></a><code><span><span class="keyword">val</span> close_in : <span><a href="#type-in_file">in_file</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Zip.copy_entry_to_file zf e destfile</code> reads and uncompresses the data associated with entry <code>e</code> of ZIP file <code>zf</code>. It then writes this data to the file named <code>destfile</code>. The file <code>destfile</code> is created if it does not exist, and overwritten otherwise. The last modification date of the file is set to that indicated in the ZIP entry <code>e</code>, if possible.</p><p>Close the given ZIP file handle. If the ZIP file handle was created by <code>open_in_channel</code>, the underlying input channel is closed.</p></div></div><h2 id="writing-to-zip-files"><a href="#writing-to-zip-files" class="anchor"></a>Writing to ZIP files</h2><div class="odoc-spec"><div class="spec type anchored" id="type-out_file"><a href="#type-out_file" class="anchor"></a><code><span><span class="keyword">type</span> out_file</span></code></div><div class="spec-doc"><p>Abstract type representing a handle opened for writing to a ZIP file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_out"><a href="#val-open_out" class="anchor"></a><code><span><span class="keyword">val</span> open_out : <span><span class="optlabel">?comment</span>:string <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-out_file">out_file</a></span></code></div><div class="spec-doc"><p>Abstract type representing a handle opened for writing to a ZIP file.</p><p>Create (or truncate to zero length) the ZIP file with the given filename. Return a handle opened for writing to this file. The optional argument <code>comment</code> is a comment string that is attached to the ZIP file as a whole (as opposed to the comments that can be attached to individual ZIP entries).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_entry"><a href="#val-add_entry" class="anchor"></a><code><span><span class="keyword">val</span> add_entry : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-out_file">out_file</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?comment</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?level</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mtime</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Create (or truncate to zero length) the ZIP file with the given filename. Return a handle opened for writing to this file. The optional argument <code>comment</code> is a comment string that is attached to the ZIP file as a whole (as opposed to the comments that can be attached to individual ZIP entries).</p><p><code>Zip.add_entry data zf name</code> adds a new entry to the ZIP file <code>zf</code>. The data (file contents) associated with the entry is taken from the string <code>data</code>. It is compressed and written to the ZIP file <code>zf</code>. <code>name</code> is the file name stored along with this entry. Several optional arguments can be provided to control the format and attached information of the entry:</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra</span> <p>extra data attached to the entry (a string). Default: empty.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">comment</span> <p>attached to the entry (a string). Default: empty.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">level</span> <p>compression level for the entry. This is an integer between 0 and 9, with 0 meaning no compression (store as is), 1 lowest compression, 9 highest compression. Higher levels result in smaller compressed data, but longer compression times. Default: 6 (moderate compression).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">mtime</span> <p>last modification time (in seconds since the epoch). Default: the current time.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_channel_to_entry"><a href="#val-copy_channel_to_entry" class="anchor"></a><code><span><span class="keyword">val</span> copy_channel_to_entry : 
  <span><a href="../../ocaml/Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-out_file">out_file</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?comment</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?level</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mtime</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>Zip.add_entry data zf name</code> adds a new entry to the ZIP file <code>zf</code>. The data (file contents) associated with the entry is taken from the string <code>data</code>. It is compressed and written to the ZIP file <code>zf</code>. <code>name</code> is the file name stored along with this entry. Several optional arguments can be provided to control the format and attached information of the entry:</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">extra</span> <p>extra data attached to the entry (a string). Default: empty.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">comment</span> <p>attached to the entry (a string). Default: empty.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">level</span> <p>compression level for the entry. This is an integer between 0 and 9, with 0 meaning no compression (store as is), 1 lowest compression, 9 highest compression. Higher levels result in smaller compressed data, but longer compression times. Default: 6 (moderate compression).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">mtime</span> <p>last modification time (in seconds since the epoch). Default: the current time.</p></li></ul><p>Same as <code>Zip.add_entry</code>, but the data associated with the entry is read from the input channel given as first argument. The channel is read up to end of file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-copy_file_to_entry"><a href="#val-copy_file_to_entry" class="anchor"></a><code><span><span class="keyword">val</span> copy_file_to_entry : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-out_file">out_file</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?comment</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?level</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mtime</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Same as <code>Zip.add_entry</code>, but the data associated with the entry is read from the input channel given as first argument. The channel is read up to end of file.</p><p>Same as <code>Zip.add_entry</code>, but the data associated with the entry is read from the file whose name is given as first argument. Also, the default value for the <code>mtime</code> optional parameter is the time of last modification of the file.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_entry_generator"><a href="#val-add_entry_generator" class="anchor"></a><code><span><span class="keyword">val</span> add_entry_generator : 
  <span><a href="#type-out_file">out_file</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?extra</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?comment</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?level</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?mtime</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>(<span>bytes <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit)</span> * <span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span></span></code></div><div class="spec-doc"><p>Same as <code>Zip.add_entry</code>, but the data associated with the entry is read from the file whose name is given as first argument. Also, the default value for the <code>mtime</code> optional parameter is the time of last modification of the file.</p><p><code>Zip.add_entry_generator zf name</code> returns a pair of functions <code>(add, finish)</code>. It adds a new entry to the ZIP file <code>zf</code>. The file name stored along with this entry is <code>name</code>. Initially, no data is stored in this entry. To store data in this entry, the program must repeatedly call the <code>add</code> function returned by <code>Zip.add_entry_generator</code>. An invocation <code>add s ofs len</code> stores <code>len</code> characters of byte sequence <code>s</code> starting at offset <code>ofs</code> in the ZIP entry. When all the data forming the entry has been sent, the program must call the <code>finish</code> function returned by <code>Zip.add_entry_generator</code>. <code>finish</code> must be called exactly once. The optional arguments to <code>Zip.add_entry_generator</code> are as described in <a href="#val-add_entry"><code>Zip.add_entry</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close_out"><a href="#val-close_out" class="anchor"></a><code><span><span class="keyword">val</span> close_out : <span><a href="#type-out_file">out_file</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Zip.add_entry_generator zf name</code> returns a pair of functions <code>(add, finish)</code>. It adds a new entry to the ZIP file <code>zf</code>. The file name stored along with this entry is <code>name</code>. Initially, no data is stored in this entry. To store data in this entry, the program must repeatedly call the <code>add</code> function returned by <code>Zip.add_entry_generator</code>. An invocation <code>add s ofs len</code> stores <code>len</code> characters of byte sequence <code>s</code> starting at offset <code>ofs</code> in the ZIP entry. When all the data forming the entry has been sent, the program must call the <code>finish</code> function returned by <code>Zip.add_entry_generator</code>. <code>finish</code> must be called exactly once. The optional arguments to <code>Zip.add_entry_generator</code> are as described in <a href="#val-add_entry"><code>Zip.add_entry</code></a>.</p><p>Finish writing the ZIP archive by adding the table of contents, and close it.</p></div></div><h2 id="error-reporting"><a href="#error-reporting" class="anchor"></a>Error reporting</h2><div class="odoc-spec"><div class="spec exception anchored" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> string * string * string</span></code></div><div class="spec-doc"><p>Exception raised when an ill-formed ZIP archive is encountered, or illegal parameters are given to the functions in this module. The exception is of the form <code>Error(ZIP_name, entry_name, message)</code> where <code>ZIP_name</code> is the name of the ZIP file, <code>entry_name</code> the name of the offending entry, and <code>message</code> an explanation of the error.</p></div></div></div></body></html>
